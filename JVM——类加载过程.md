JVM——类加载过程

#### 类的生命周期（7个阶段）：

加载、验证、准备、解析、初始化、使用和卸载

#### 类加载过程：

加载过程分为三步：加载->连接（验证->准备->解析）->初始化

##### 1.加载

1. 通过全类名获取定义此类的二进制字节流
2. 将字节流所代表的的静态存储结构转换为方法区的运行时数据结构
3. 在内存中生成一个代表该类的Class对象，作为方法区这些数据的访问入口

​	加载这一步由**类加载器**来完成，具体哪个类加载器由**双亲委派模型**来决定

##### 2.验证

​	**验证是连接阶段的第一步，这一阶段的目的是确保 Class 文件的字节流中包含的信息符合《Java 虚拟机规范》的全部约束要求，保证这些信息被当作代码运行后不会危害虚拟机自身的安全。**

​	**可以有效防止恶意代码的执行**

​	主要有四个检验阶段组成：

1. 文件格式验证（Class文件格式检查）
2. 元数据验证（字节码语义检查）
3. 字节码验证（程序语义检查）
4. 符号引用验证（类的正确性检查）

##### 3.准备

​	**准备阶段是正式为类变量分配内存并设置类变量初始值的阶段**， 这些内存都将在方法区中分配。进行内存分配的仅包括类变量（ 即静态变量，被 `static` 关键字修饰的变量，只与类相关，因此被称为类变量），而不包括实例变量，实例变量会在对象实例化时随着对象一块分配在 Java 堆中。

##### 4.解析

**解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程。** 

##### 5.初始化

**初始化阶段是执行初始化方法 `<clinit> ()`方法的过程，是类加载的最后一步，这一步 JVM 才开始真正执行类中定义的 Java 程序代码(字节码)。**

初始化阶段，虚拟机严格规范了有且只有 6 种情况下，必须对类进行初始化(只有主动去使用类才会初始化类)：



#### 类卸载

卸载类需要满足 3 个要求:

1. 该类的所有的实例对象都已被 GC，也就是说堆不存在该类的实例对象。
2. 该类没有在其他任何地方被引用
3. 该类的类加载器的实例已被 GC